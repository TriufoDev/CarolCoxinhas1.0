<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Admin - Carol Coxinhas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .glass-panel { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Background Animado (Copiado do Acompanhar Pedido para consistência) */
        .bg-animated {
            background: linear-gradient(-45deg, #1a1a2e, #16213e, #4a148c, #311b92);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    </style>
</head>
<body class="bg-gray-100 font-sans min-h-screen">

    <!-- Tela de Login -->
    <div id="login-screen" class="fixed inset-0 bg-animated flex items-center justify-center z-50">
        <div class="glass-panel p-8 rounded-2xl shadow-2xl w-96 animate-fade-in border border-white/20">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
                    <i class="fas fa-user-shield text-3xl text-white"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-800">Painel Admin</h2>
                <p class="text-gray-500 text-sm">Carol Coxinhas</p>
            </div>
            <input type="password" id="password-input" placeholder="Senha de Acesso" class="w-full p-3 border rounded mb-4 focus:outline-none focus:border-red-500">
            <button onclick="checkLogin()" class="w-full bg-red-600 text-white font-bold py-3 rounded hover:bg-red-700 transition">Entrar</button>
            <p id="login-error" class="text-red-500 text-sm mt-2 text-center hidden">Senha incorreta.</p>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2 pointer-events-none"></div>

    <!-- Painel Principal (Oculto inicialmente) -->
    <div id="admin-panel" class="hidden min-h-screen flex flex-col">
        <!-- Navbar -->
        <nav class="bg-red-800 text-white shadow-lg">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <h1 class="text-xl font-bold"><i class="fas fa-cogs mr-2"></i>Painel Administrativo</h1>
                <div class="flex items-center gap-4">
                    <a href="pedidos.html" class="text-yellow-300 hover:text-white text-sm font-bold border border-yellow-500 hover:bg-yellow-500 hover:text-red-900 px-3 py-1 rounded transition"><i class="fas fa-tv mr-1"></i> Tela Cozinha</a>
                    <a href="index.html" target="_blank" class="text-red-200 hover:text-white text-sm"><i class="fas fa-external-link-alt mr-1"></i> Ver Site</a>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm">Sair</button>
                </div>
            </div>
        </nav>

        <div class="flex flex-1 container mx-auto p-4 gap-6">
            <!-- Sidebar -->
            <aside class="w-64 bg-white rounded-lg shadow-md h-fit">
                <nav class="p-4 space-y-2">
                    <button onclick="showTab('dashboard')" class="w-full text-left p-3 rounded hover:bg-red-50 text-red-900 font-medium tab-btn active-tab" data-tab="dashboard">
                        <i class="fas fa-chart-line w-6"></i> Dashboard
                    </button>
                    <button onclick="showTab('products')" class="w-full text-left p-3 rounded hover:bg-red-50 text-gray-600 font-medium tab-btn" data-tab="products">
                        <i class="fas fa-box w-6"></i> Produtos
                    </button>
                    <button onclick="showTab('testimonials')" class="w-full text-left p-3 rounded hover:bg-red-50 text-gray-600 font-medium tab-btn" data-tab="testimonials">
                        <i class="fas fa-comments w-6"></i> Depoimentos
                    </button>
                    <button onclick="showTab('settings')" class="w-full text-left p-3 rounded hover:bg-red-50 text-gray-600 font-medium tab-btn" data-tab="settings">
                        <i class="fas fa-sliders-h w-6"></i> Configurações
                    </button>
                </nav>
            </aside>

            <!-- Content Area -->
            <main class="flex-1 bg-white rounded-lg shadow-md p-6">
                
                <!-- Dashboard Tab -->
                <div id="tab-dashboard" class="tab-content">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Visão Geral</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-4 rounded-xl shadow-lg text-white transform hover:scale-105 transition">
                            <p class="font-bold opacity-80">Total de Pedidos</p>
                            <h3 id="total-orders-count" class="text-4xl font-bold mt-1">0</h3>
                        </div>
                        <div class="bg-gradient-to-br from-blue-500 to-indigo-600 p-4 rounded-xl shadow-lg text-white transform hover:scale-105 transition">
                            <p class="font-bold opacity-80">Receita Estimada</p>
                            <h3 id="total-revenue" class="text-4xl font-bold mt-1">R$ 0,00</h3>
                        </div>
                    </div>
                    
                    <!-- Gráfico de Vendas -->
                    <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm mb-8 h-80">
                        <h3 class="text-lg font-bold text-gray-700 mb-4">Histórico de Vendas</h3>
                        <canvas id="salesChart"></canvas>
                    </div>
                    
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold text-gray-700">Últimos Pedidos (WhatsApp)</h3>
                        <button onclick="clearAllOrders()" class="bg-red-100 text-red-600 hover:bg-red-200 px-3 py-1 rounded text-sm font-bold transition">
                            <i class="fas fa-trash-alt mr-1"></i> Limpar Histórico
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead>
                                <tr class="bg-gray-100 border-b">
                                    <th class="p-3">Data</th>
                                    <th class="p-3">Itens</th>
                                    <th class="p-3">Total</th>
                                    <th class="p-3">Status</th>
                                    <th class="p-3 text-center">Ações</th>
                                </tr>
                            </thead>
                            <tbody id="orders-table-body">
                                <!-- Pedidos via JS -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!--     Products Tab -->
                <div id="tab-products" class="tab-content hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">Gerenciar Produtos</h2>
                        <button onclick="openProductForm()" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                            <i class="fas fa-plus mr-2"></i> Novo Produto
                        </button>
                    </div>
                    <div id="admin-product-list" class="grid grid-cols-1 gap-4">
                        <!-- Lista de produtos via JS -->
                    </div>
                </div>

                <!-- Testimonials Tab -->
                <div id="tab-testimonials" class="tab-content hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Gerenciar Depoimentos</h2>
                    
                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-yellow-600 mb-3 border-b pb-2"><i class="fas fa-clock mr-2"></i> Pendentes de Aprovação</h3>
                        <div id="pending-testimonials-list" class="space-y-4">
                            <!-- Lista de pendentes -->
                        </div>
                    </div>

                    <div>
                        <h3 class="text-lg font-bold text-green-600 mb-3 border-b pb-2"><i class="fas fa-check-circle mr-2"></i> Aprovados (No Site)</h3>
                        <div id="approved-testimonials-list" class="space-y-4">
                            <!-- Lista de aprovados -->
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="tab-settings" class="tab-content hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">Configurações do Site</h2>
                    
                    <div class="space-y-4 max-w-lg">
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Nome do Site</label>
                            <input type="text" id="site-title" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Título Principal (Hero)</label>
                            <input type="text" id="hero-title" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Subtítulo</label>
                            <input type="text" id="hero-subtitle" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">WhatsApp (Apenas números, com DDD)</label>
                            <input type="text" id="whatsapp-number" class="w-full p-2 border rounded" placeholder="5511999999999">
                        </div>
                        <button onclick="saveSiteConfig()" class="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600 font-bold">Salvar Alterações</button>

                        <hr class="my-8">

                        <h3 class="text-xl font-bold text-red-600 mb-4">Segurança</h3>
                        <div>
                            <label class="block text-gray-700 font-bold mb-2">Nova Senha do Painel</label>
                            <input type="password" id="new-admin-pass" class="w-full p-2 border rounded">
                        </div>
                        <button onclick="changePassword()" class="bg-red-500 text-white px-6 py-2 rounded hover:bg-red-600 font-bold mt-2">Alterar Senha</button>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Edição de Produto -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex justify-center items-center p-4">
        <div class="bg-white w-full max-w-lg rounded-lg shadow-xl p-6">
            <h3 id="modal-form-title" class="text-xl font-bold mb-4">Editar Produto</h3>
            <input type="hidden" id="edit-id">
            
            <div class="space-y-3">
                <div>
                    <label class="block text-sm font-bold text-gray-700">Nome</label>
                    <input type="text" id="edit-name" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700">Descrição</label>
                    <textarea id="edit-desc" class="w-full p-2 border rounded"></textarea>
                </div>
                <div class="flex gap-4">
                    <div class="flex-1">
                        <label class="block text-sm font-bold text-gray-700">Preço (R$)</label>
                        <input type="number" step="0.01" id="edit-price" class="w-full p-2 border rounded">
                    </div>
                    <div class="flex items-center mt-6">
                        <input type="checkbox" id="edit-hasSizes" class="mr-2">
                        <label class="text-sm text-gray-700">Tem tamanhos?</label>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-bold text-gray-700">URL da Imagem</label>
                    <input type="text" id="edit-image" class="w-full p-2 border rounded" placeholder="https://...">
                </div>
            </div>

            <div class="mt-6 flex justify-end gap-3">
                <button onclick="closeProductForm()" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded">Cancelar</button>
                <button onclick="saveProduct()" class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // --- Autenticação ---
        // Senha padrão inicial se não houver no localStorage
        if (!localStorage.getItem('kelo_admin_pass')) {
            localStorage.setItem('kelo_admin_pass', 'admin123');
        }

        function checkLogin() {
            const input = document.getElementById('password-input').value;
            let storedPass = localStorage.getItem('kelo_admin_pass');
            
            if (!storedPass) {
                storedPass = 'admin123';
                localStorage.setItem('kelo_admin_pass', storedPass);
            }
            
            if (input === storedPass) {
                document.getElementById('login-screen').classList.add('hidden');
                document.getElementById('admin-panel').classList.remove('hidden');
                loadDashboard();
                loadProducts();
                loadTestimonialsTab();
                loadSettings();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        function logout() {
            location.reload();
        }

        function changePassword() {
            const newPass = document.getElementById('new-admin-pass').value;
            if(newPass.length < 4) return alert("A senha deve ter pelo menos 4 caracteres.");
            localStorage.setItem('kelo_admin_pass', newPass);
            alert("Senha alterada com sucesso!");
            document.getElementById('new-admin-pass').value = '';
        }

        // --- Navegação (Tabs) ---
        function showTab(tabName) {
            // Esconder todos
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-btn').forEach(el => {
                el.classList.remove('bg-red-50', 'text-red-900', 'border-l-4', 'border-red-600');
                el.classList.add('text-gray-600');
            });

            // Mostrar atual
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
            const btn = document.querySelector(`button[data-tab="${tabName}"]`);
            btn.classList.add('bg-red-50', 'text-red-900', 'border-l-4', 'border-red-600');
            btn.classList.remove('text-gray-600');
        }

        // --- Dashboard ---
        function loadDashboard() {
            let orders = [];
            try {
                orders = JSON.parse(localStorage.getItem('kelo_orders')) || [];
            } catch (e) {
                console.error("Erro ao ler pedidos:", e);
            }
            
            // Stats
            document.getElementById('total-orders-count').innerText = orders.length;
            const totalRev = orders.reduce((sum, order) => sum + order.total, 0);
            document.getElementById('total-revenue').innerText = totalRev.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

            // Chart
            renderSalesChart(orders);

            // Table
            const tbody = document.getElementById('orders-table-body');
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="p-4 text-center text-gray-500">Nenhum pedido registrado ainda.</td></tr>';
            } else {
                const statusOptions = ['Enviado', 'Em Preparo', 'Saiu para Entrega', 'Entregue'];
                
                tbody.innerHTML = orders.slice(0, 10).map(order => `
                    <tr class="border-b hover:bg-gray-50">
                        <td class="p-3 text-sm">
                            <div class="font-bold text-gray-700">#${order.id}</div>
                            <div class="text-xs text-gray-500">${order.date}</div>
                        </td>
                        <td class="p-3 text-sm">
                            ${order.items.map(i => `${i.quantity}x ${i.name}`).join(', ')}
                        </td>
                        <td class="p-3 font-bold text-red-700">R$ ${order.total.toFixed(2)}</td>
                        <td class="p-3">
                            <select onchange="updateOrderStatus(${order.id}, this.value)" class="text-xs border border-gray-300 rounded p-1 bg-white focus:outline-none focus:border-red-500 cursor-pointer shadow-sm">
                                ${statusOptions.map(s => `<option value="${s}" ${order.status === s ? 'selected' : ''}>${s}</option>`).join('')}
                            </select>
                        </td>
                        <td class="p-3 text-center">
                            <button onclick="deleteOrder(${order.id})" class="text-red-500 hover:bg-red-100 p-2 rounded transition" title="Excluir Pedido">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        let salesChartInstance = null;

        function renderSalesChart(orders) {
            const ctx = document.getElementById('salesChart').getContext('2d');
            
            // Agrupar vendas por data
            const salesByDate = {};
            
            // Ordenar cronologicamente (antigo -> novo)
            const sortedOrders = [...orders].sort((a, b) => a.id - b.id);

            sortedOrders.forEach(order => {
                const dateObj = new Date(order.id);
                const dateStr = dateObj.toLocaleDateString('pt-BR'); // DD/MM/AAAA
                
                if (!salesByDate[dateStr]) salesByDate[dateStr] = 0;
                salesByDate[dateStr] += order.total;
            });

            const labels = Object.keys(salesByDate);
            const data = Object.values(salesByDate);

            if (salesChartInstance) salesChartInstance.destroy();

            salesChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Vendas (R$)',
                        data: data,
                        backgroundColor: 'rgba(220, 38, 38, 0.6)',
                        borderColor: 'rgba(220, 38, 38, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.y.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'R$ ' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        function showToast(message) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'bg-green-500 text-white px-4 py-3 rounded shadow-lg flex items-center gap-2 transform transition-all duration-300 translate-x-full pointer-events-auto';
            toast.innerHTML = `<i class="fas fa-check-circle"></i> <span>${message}</span>`;
            
            container.appendChild(toast);
            
            // Animation
            requestAnimationFrame(() => toast.classList.remove('translate-x-full'));
            
            setTimeout(() => {
                toast.classList.add('translate-x-full', 'opacity-0');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function updateOrderStatus(id, newStatus) {
            let orders = JSON.parse(localStorage.getItem('kelo_orders')) || [];
            const index = orders.findIndex(o => o.id === id);
            if (index > -1) {
                orders[index].status = newStatus;
                localStorage.setItem('kelo_orders', JSON.stringify(orders));
                showToast(`Pedido #${id} atualizado para: ${newStatus}`);
            }
        }

        function deleteOrder(id) {
            if(confirm("Tem certeza que deseja excluir este pedido do histórico?")) {
                let orders = JSON.parse(localStorage.getItem('kelo_orders')) || [];
                orders = orders.filter(o => o.id !== id);
                localStorage.setItem('kelo_orders', JSON.stringify(orders));
                loadDashboard();
                showToast("Pedido excluído com sucesso!");
            }
        }

        function clearAllOrders() {
            if(confirm("ATENÇÃO: Isso apagará TODOS os pedidos do histórico permanentemente.\n\nDeseja continuar?")) {
                localStorage.setItem('kelo_orders', '[]');
                loadDashboard();
                showToast("Histórico limpo com sucesso!");
            }
        }

        // --- Produtos ---
        // Mesma lista padrão do index para inicialização
        const defaultProducts = [
            { id: 101, name: "Copo P (Mini Coxinhas)", description: "Aproximadamente 15 unidades. Crocantes e quentinhas.", price: 0, hasSizes: true, image: "https://images.unsplash.com/photo-1626082927389-6cd097cdc6ec?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" },
            { id: 3, name: "Barca de Salgados", description: "Mix de coxinhas, kibe e bolinhas de queijo.", price: 45.00, hasSizes: false, image: "https://images.unsplash.com/photo-1563379926898-05f4575a45d8?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" },
            { id: 4, name: "Porção de Churros", description: "10 unidades de mini churros com doce de leite.", price: 18.00, hasSizes: false, image: "https://images.unsplash.com/photo-1604382354936-07c5d9983bd3?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" },
            { id: 5, name: "Copo Kids (Salgadinhos)", description: "Porção menor, sem pimenta, ideal para crianças.", price: 10.00, hasSizes: false, image: "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" },
            { id: 6, name: "Combo Família", description: "50 coxinhas + 50 bolinhas de queijo + Refri 2L.", price: 55.00, hasSizes: false, image: "https://images.unsplash.com/photo-1513456852971-30c0b8199d4d?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60" }
        ];

        function getProducts() {
            return JSON.parse(localStorage.getItem('kelo_products')) || defaultProducts;
        }

        function loadProducts() {
            const products = getProducts();
            const container = document.getElementById('admin-product-list');
            
            container.innerHTML = products.map(p => `
                <div class="flex items-center justify-between bg-white border p-4 rounded-lg shadow-sm">
                    <div class="flex items-center gap-4">
                        <img src="${p.image}" class="w-16 h-16 object-cover rounded">
                        <div>
                            <h4 class="font-bold text-gray-800">${p.name}</h4>
                            <p class="text-sm text-gray-500">${p.hasSizes ? 'Preço Variável (Tamanhos)' : 'R$ ' + p.price.toFixed(2)}</p>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editProduct(${p.id})" class="text-blue-500 hover:bg-blue-50 p-2 rounded"><i class="fas fa-edit"></i></button>
                        <button onclick="deleteProduct(${p.id})" class="text-red-500 hover:bg-red-50 p-2 rounded"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            `).join('');
        }

        // Form Modal Logic
        const modal = document.getElementById('edit-modal');
        
        function openProductForm(id = null) {
            modal.classList.remove('hidden');
            if (id) {
                // Edit Mode
                const products = getProducts();
                const p = products.find(x => x.id === id);
                document.getElementById('modal-form-title').innerText = "Editar Produto";
                document.getElementById('edit-id').value = p.id;
                document.getElementById('edit-name').value = p.name;
                document.getElementById('edit-desc').value = p.description;
                document.getElementById('edit-price').value = p.price;
                document.getElementById('edit-hasSizes').checked = p.hasSizes;
                document.getElementById('edit-image').value = p.image;
            } else {
                // Create Mode
                document.getElementById('modal-form-title').innerText = "Novo Produto";
                document.getElementById('edit-id').value = '';
                document.getElementById('edit-name').value = '';
                document.getElementById('edit-desc').value = '';
                document.getElementById('edit-price').value = '';
                document.getElementById('edit-hasSizes').checked = false;
                document.getElementById('edit-image').value = '';
            }
        }

        function closeProductForm() {
            modal.classList.add('hidden');
        }

        function saveProduct() {
            const id = document.getElementById('edit-id').value;
            const name = document.getElementById('edit-name').value;
            const desc = document.getElementById('edit-desc').value;
            const price = parseFloat(document.getElementById('edit-price').value) || 0;
            const hasSizes = document.getElementById('edit-hasSizes').checked;
            const image = document.getElementById('edit-image').value || 'https://via.placeholder.com/150';

            if (!name) return alert("Nome é obrigatório");

            let products = getProducts();

            if (id) {
                // Update
                const index = products.findIndex(p => p.id == id);
                if (index > -1) {
                    products[index] = { ...products[index], name, description: desc, price, hasSizes, image };
                }
            } else {
                // Create
                const newId = Date.now(); // Simple ID generation
                products.push({ id: newId, name, description: desc, price, hasSizes, image });
            }

            localStorage.setItem('kelo_products', JSON.stringify(products));
            closeProductForm();
            loadProducts();
            alert("Produto salvo! Atualize a página principal para ver as mudanças.");
        }

        function deleteProduct(id) {
            if(confirm("Tem certeza que deseja excluir este produto?")) {
                let products = getProducts();
                products = products.filter(p => p.id !== id);
                localStorage.setItem('kelo_products', JSON.stringify(products));
                loadProducts();
            }
        }

        // --- Depoimentos ---
        function loadTestimonialsTab() {
            const testimonials = JSON.parse(localStorage.getItem('kelo_testimonials')) || [];
            const pending = testimonials.filter(t => t.status === 'pending');
            const approved = testimonials.filter(t => t.status === 'approved');

            const pendingContainer = document.getElementById('pending-testimonials-list');
            const approvedContainer = document.getElementById('approved-testimonials-list');

            // Render Pending
            if (pending.length === 0) {
                pendingContainer.innerHTML = '<p class="text-gray-500 italic">Nenhum depoimento pendente.</p>';
            } else {
                pendingContainer.innerHTML = pending.map(t => `
                    <div class="bg-yellow-50 border border-yellow-200 p-4 rounded-lg flex flex-col md:flex-row gap-4 items-start">
                        ${t.photo ? `<img src="${t.photo}" class="w-20 h-20 object-cover rounded">` : '<div class="w-20 h-20 bg-gray-200 rounded flex items-center justify-center text-gray-400"><i class="fas fa-user"></i></div>'}
                        <div class="flex-1">
                            <div class="flex justify-between">
                                <h4 class="font-bold text-gray-800">${t.name}</h4>
                                <span class="text-yellow-500 font-bold"><i class="fas fa-star"></i> ${t.stars}</span>
                            </div>
                            <p class="text-gray-600 text-sm mt-1">"${t.text}"</p>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="approveTestimonial(${t.id})" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 text-sm"><i class="fas fa-check"></i> Aprovar</button>
                            <button onclick="rejectTestimonial(${t.id})" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 text-sm"><i class="fas fa-times"></i> Rejeitar</button>
                        </div>
                    </div>
                `).join('');
            }

            // Render Approved
            if (approved.length === 0) {
                approvedContainer.innerHTML = '<p class="text-gray-500 italic">Nenhum depoimento aprovado.</p>';
            } else {
                approvedContainer.innerHTML = approved.map(t => `
                    <div class="bg-white border p-4 rounded-lg flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            ${t.photo ? `<img src="${t.photo}" class="w-10 h-10 object-cover rounded-full">` : '<div class="w-10 h-10 bg-gray-100 rounded-full flex items-center justify-center text-gray-400"><i class="fas fa-user"></i></div>'}
                            <div>
                                <h4 class="font-bold text-gray-800 text-sm">${t.name} <span class="text-yellow-500 ml-2"><i class="fas fa-star"></i> ${t.stars}</span></h4>
                                <p class="text-gray-500 text-xs truncate max-w-md">${t.text}</p>
                            </div>
                        </div>
                        <button onclick="rejectTestimonial(${t.id})" class="text-red-500 hover:bg-red-50 p-2 rounded" title="Excluir"><i class="fas fa-trash"></i></button>
                    </div>
                `).join('');
            }
        }

        function approveTestimonial(id) {
            let testimonials = JSON.parse(localStorage.getItem('kelo_testimonials')) || [];
            const index = testimonials.findIndex(t => t.id === id);
            if (index > -1) {
                testimonials[index].status = 'approved';
                localStorage.setItem('kelo_testimonials', JSON.stringify(testimonials));
                loadTestimonialsTab();
            }
        }

        function rejectTestimonial(id) {
            if(confirm("Tem certeza que deseja remover este depoimento?")) {
                let testimonials = JSON.parse(localStorage.getItem('kelo_testimonials')) || [];
                testimonials = testimonials.filter(t => t.id !== id);
                localStorage.setItem('kelo_testimonials', JSON.stringify(testimonials));
                loadTestimonialsTab();
            }
        }

        // --- Configurações ---
        function loadSettings() {
            const config = JSON.parse(localStorage.getItem('kelo_config')) || {
                title: "Carol Coxinhas",
                heroTitle: "O Sabor que Apaixona",
                heroSubtitle: "Coxinhas douradas, crocantes e muito recheadas.",
                whatsappNumber: "5511999999999"
            };
            document.getElementById('site-title').value = config.title;
            document.getElementById('hero-title').value = config.heroTitle;
            document.getElementById('hero-subtitle').value = config.heroSubtitle;
            document.getElementById('whatsapp-number').value = config.whatsappNumber || "5511999999999";
        }

        function saveSiteConfig() {
            const config = {
                title: document.getElementById('site-title').value,
                heroTitle: document.getElementById('hero-title').value,
                heroSubtitle: document.getElementById('hero-subtitle').value,
                whatsappNumber: document.getElementById('whatsapp-number').value
            };
            localStorage.setItem('kelo_config', JSON.stringify(config));
            alert("Configurações salvas! Atualize a página principal.");
        }

        // Inicializar Tab
        showTab('dashboard');

        // Atualização automática do Dashboard
        setInterval(() => {
            if (!document.getElementById('tab-dashboard').classList.contains('hidden')) {
                loadDashboard();
            }
        }, 5000);
    </script>
</body>
</html>